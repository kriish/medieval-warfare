<doctype html />
<html>
<head>
    	<link href="css/style.css" rel="stylesheet" type="text/css" media="all">
    	<script src="js/contextmenu.js" type="text/javascript"></script>

<script src="js/cell.js"></script>  
<script src="js/cellgrid.js"></script>  
<script src="js/honeycomb.js"></script>  
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>  
        <script src="js/jquery.js" type="text/javascript"></script>
        <script src="js/jquery.rightClick.js" type="text/javascript"></script>
<script type="text/javascript">
<!--

// city name
function hideCityName() {
    $('#new-city-name').hide(); // city-name
}
function showCityName() {
    $('#new-city-name').show(); // city-name
    $('#new-city-name').offset({ top: mouseY, left: mouseX });
//	$('#new-city-name').width($(contextName).width());
//	$('#new-city-name').height($(contextName).height());

}
function initCityName() {}
function keyPressedCallback(event) {
           event = event || window.event;

           if (event.metaKey)
             return;

           var keyChar =String.fromCharCode(o3djs.event.getEventKeyChar(event));
           keyChar = keyChar.toLowerCase();
    $('#city-name').append(keyChar);
    
         }
function getCityName(nameFinished) {
  var name = false;
  window.document.onkeypress = keyPressedCallback;
  showCityName();
  
  return name;
}
function cityNameFinished() {

}
// eof city name

// start of context menu

                var contextName = '#context'; // basic context, nothing on selected area
    		function Init()
			{
				$("#right-click-controller").rightClick(function(e) {
					$('<div id="overlay" class="overlay" style="position: absolute; left: 0; top: 0; width: 100%; height: 100%; z-index: 100;"></div>').click(function() {
						$(this).remove();
						HideContextMenu();
					}).appendTo(document.body);
					ShowContextMenu(e.pageX, e.pageY);
				});
			}
			
			function ShowContextMenu(mouseX, mouseY)
			{
                if (currentlySelectedCell && currentlySelectedCell.city) {
                        alert('we have city in the cell');
                        contextName = '#context-city';
                    
                } else {
                   contextName = '#context';
                     }
				$(contextName).css({zIndex: '102'}).show();
				$(contextName).offset({ top: mouseY, left: mouseX });
				$('#context-menu-bkg').show();
				$('#context-menu-bkg').offset({ top: mouseY, left: mouseX });
				$('#context-menu-bkg').width($(contextName).width());
				$('#context-menu-bkg').height($(contextName).height());
			}
			
			function HideContextMenu()
			{
				$('#context-menu-bkg').hide();
				$(contextName).hide();
				$('#overlay').remove();
			}
            // end of context menu

function canvasWidth() {
  return 600;
  }
    
function canvasHeight() {
    return 600;
}
var eventDisplay = "test";
    function drawRegionDisplay(context){
        context.font = "18pt Calibri";
        context.fillStyle = "black";
        context.fillText(eventDisplay, 10, 25);
    }
 
    function drawEventDisplay(context, text){
        context.font = "18pt Calibri";
        context.fillStyle = "black";
        context.fillText(text, 10, 25);
    }

function regionListeners(canvas, context) {
    var myStage = new Kinetic.Stage(canvas);
           // draw darth vader image and attach listeners
            myStage.beginRegion();
//            context.drawImage(darthVaderImg, 100, 50, 200, 137);
            // draw rectangular region for image
            context.beginPath();
            context.rect(50, 50, 200, 200);
            context.closePath();
 
            myStage.addRegionEventListener("onmouseover", function(){
                console.log("mouseup");
                eventDisplay = "Darth Vader mouseover!";
            });
            myStage.addRegionEventListener("onmouseout", function(){
                console.log("mouseup");
                eventDisplay = "Darth Vader mouseout!";
            });
            myStage.addRegionEventListener("onmousedown", function(){
                console.log("mouseup");
                eventDisplay = "Darth Vader mousedown!";
            });
            myStage.addRegionEventListener("onmouseup", function(){
                console.log("mouseup");
                eventDisplay = "Darth Vader mouseup!";
            });
            myStage.closeRegion();
            drawRegionDisplay(context);
}    
    
/*
function drawGrid(context) {
    var cellSize = 50;
  for (var x = 0.5; x < canvasWidth(); x += cellSize) {
    context.moveTo(x, 0);
    context.lineTo(x, canvasHeight());
  }
 
  for (var y = 0.5; y < canvasHeight(); y += cellSize) {
    context.moveTo(0, y);
    context.lineTo(canvasWidth(), y);
  }    
  
  context.strokeStyle = "#ee0";
  context.stroke();
  
//  chooseTile(context, 0, 0);
}
*/

function setBackgroundImage(context) {
//    var sun = document.getElementById("sun");
    // or
    var sun = new Image();
   sun.src = "img/map1.jpg";

  context.drawImage(sun, 0, 0);
  //alert("test");
}

function writeText(context) {
    context.font = "bold 16px sans-serif";
    context.fillText("Mamadou", 248, 43);
//    context.fillText("y", 58, 165);
}

function handleMouseover(e) {
  var canvas = document.getElementById("top");
  var context = canvas.getContext("2d");

var mouseX = e.clientX - canvas.offsetLeft;
    var mouseY = e.clientY - canvas.offsetTop;
 
   if(mouseX < 100 && mouseY < 100) {
       console.log("in region");
       drawEventDisplay(context,"in corner");
   } else {
       console.log("out of region");
       drawEventDisplay(context,"outta here");

    }
    
    highlightTile(mouseX, mouseY);
    
}

function getActionContext() {
      var topCanvas = document.getElementById("action");
  var topContext = topCanvas.getContext("2d");
  return topContext
    }
// TODO third middle canvas for cities and troops? now top
function createCity() {
    var newCity = new City(currentlySelectedCell);
    newCity.draw(getActionContext());
}
function createMonument() {
    var newCity = new City(currentlySelectedCell);
    newCity.draw(getActionContext());
}
function createTroop() {
    var newCity = new City(currentlySelectedCell);
    newCity.draw(getActionContext());
}
function createMine() {
    var newCity = new City(currentlySelectedCell);
    newCity.draw(getActionContext());
}
function cityInfo() {
  var info = document.getElementById("info");
  info.innerHTML = "TODO";
}
function troopInfo() {
  var info = document.getElementById("info");
  info.innerHTML = "TODO troop info";
}

function submitRound() {
    alert('TODO');
}

window.onload = function() {
  var mapCanvas = document.getElementById("map");
  var mapContext = mapCanvas.getContext("2d");
  setBackgroundImage(mapContext);
  
  var topCanvas = document.getElementById("top");
  var topContext = topCanvas.getContext("2d");
  writeText(topContext);
  topCanvas.addEventListener("click", selectSquare, false);
//  topCanvas.addEventListener("mouseup", selectSquare, false);
//  drawGrid(context);
//  honeycomb(topContext);
//  selectHoneycomb(topContext);
//regionListeners(topCanvas, topContext);
  topCanvas.addEventListener("mousemove", handleMouseover, false);
  Init();
}
//-->
</script>

</head>
<body><!-- onload="Init();"-->
<!-- right click context menu http://www.webreference.com/programming/jquery/context-menu/ -->
<!-- onmousemove="handleMouseover(event)"-->
<!--button onclick="createCity();return false;">Create city</button>
<button onclick="createMonument();return false;">Create monument</button>
<button onclick="createMine();return false;">Create mine</button>
<button onclick="createTroop();return false;">New troop</button-->

<div id="context-menu-bkg" style="display: none;"></div>
		<div id="context" class="context-menu">
			<div class="menu-item allow-hover" onclick="createCity(); HideContextMenu();">Create city</div>
			<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Create monument</div>
    		<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Create mine</div>
			<div class="menu-item disabled">Mark as Completed</div>
			<div class="separator-line"></div>
			<div class="menu-item allow-hover" onclick="cityInfo(); HideContextMenu();">City info</div>
			<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Troop info</div>
		</div>
        <div id="context-city" class="context-menu">
    		<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Build church</div>
			<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Build granary</div>
    		<div class="menu-item allow-hover" onclick="alert('TODO'); HideContextMenu();">Build X</div>
			<div class="separator-line"></div>
			<div class="menu-item allow-hover" onclick="cityInfo(); HideContextMenu();">Create troops</div>
			<div class="menu-item allow-hover" onclick="cityInfo(); HideContextMenu();">Troop info</div>
    		<div class="menu-item allow-hover" onclick="troopInfo(); HideContextMenu();">City info</div>
		</div>
		<!--div id="right-click-controller" style="height: 100px; width: 300px; border: 1px solid #999; padding: 10px">right click here</div-->

<div id="new-city-name" style="display: none;">
  <input type="text" name="city-name"/>
</div>

<!-- map is the background map, action holds cities and troops, top holds selections -->
<div id="right-click-controller" style="position: relative;">
 <canvas id="map" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
 <canvas id="action" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
 <canvas id="top" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
</div>
<div id="info" style="position: relative;left:600px;">
This is the info chart<br>
<p>
<h2>Create city</h2>
City name <input id="cityName" type="text"/>
<button>Create</button><button>Cancel</button>
</p>
<p>
<h2>Create troops</h2>
Troop name <input name="troopName" type="text"/>
Troop type <select><option>Infantry</option><option>Horsemen</option></select>
Troop size <input name="troopSize" type="text"/>
<button>Create</button><button>Cancel</button>
</p>
<p>
<button onclick="submitRound();return false;">Submit round</button>
</p>
</div>
<!--http://www.javascriptkit.com/javatutors/crossmenu.shtml-->


</body>
</html>